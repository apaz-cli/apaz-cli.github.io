<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Errors and Configuration</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
  /* https://github.com/markdowncss/retro/blob/master/css/retro.css */

  @font-face {
      font-family: "lemon";
      src: url('lemon.woff');
  }

  /*
  @media print {
      *, *:before, *:after {
          background: transparent !important;
          color: #000 !important;
          box-shadow: none !important;
          text-shadow: none !important;
      }
      a, a:visited { text-decoration: underline; }
      a[href]:after { content: " (" attr(href) ")"; }
      abbr[title]:after { content: " (" attr(title) ")"; }
      a[href^="#"]:after, a[href^="javascript:"]:after { content: ""; }
      pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
      thead { display: table-header-group; }
      tr, img { page-break-inside: avoid; }
      img { max-width: 100% !important; }
      p, h2, h3 { orphans: 3; widows: 3; }
      h2, h3 { page-break-after: avoid; }
  }
  */
  a, a:visited { color: #01ff70; }
  a:hover, a:focus, a:active { color: #2ecc40; }
  .retro-no-decoration { text-decoration: none; }
  p, .retro-p {
      font-size: 1rem;
      margin-bottom: 1.3rem;
      /*text-indent: 50px*/
  }
  h1, .retro-h1, h2, .retro-h2, h3, .retro-h3, h4, .retro-h4 {
      font-family: "lemon";
      margin: 1.414rem 0 .5rem;
      font-weight: inherit;
      line-height: 1.42;
  }
  h1, .retro-h1 {
      color: rgb(112, 221, 0);
      margin-top: 0;
      font-size: 3.998rem;
  }
  h2, .retro-h2 {
      color: rgb(112, 221, 0);
      margin-top: 0;
      font-size: 2.827rem;
  }
  h3, .retro-h3 {
      font-size: 1.999rem;
  }
  h4, .retro-h4 {
      font-size: 1.414rem;
  }
  h5, .retro-h5 {
      font-size: 1.121rem;
  }
  h6, .retro-h6 {
      font-size: .88rem;
  }
  small, .retro-small {
      font-size: .707em;
  }

  img, canvas, iframe, video, svg, select, textarea { max-width: 100%; }

  html, body {
      /* background-image: url(https://raw.githubusercontent.com/apaz-cli/apaz-cli.github.io/master/pattern.png); */
      background-color: #222;
      min-height: 100%;
      font-size: 20px;
  }
  body {
      color: #fafafa;
      /* font-family:  "lemon", "Courier New"; */
      line-height: 1.65;
      margin: 6rem auto 1rem;
      max-width: 48rem;
      /* padding: .25rem; */
  }
  pre, code {
      background-color: #333;
      font-family: "lemon", "Menlo", "Monaco", "Courier New";
      font-size: 12;
  }

  code span.dt { color: #e4a51e; } /* DataType */

  pre {
      padding: .5rem;
      line-height: 1.25;
      overflow-x: scroll;
  }
  blockquote {
      border-left: 3px solid #01ff70;
      padding-left: 1rem;
  }
  </style>
</head>
<body>
<h1 id="errors-and-configuration">Errors and Configuration</h1>
<p>If there's one thing that programmers hate, it's edge cases. They're annoying and time consuming.</p>
<p><img src="images/Snake_moriya_suwako.jpg" /></p>
<p>The more sources for error you have, the more edge cases you're likely to have. Unfortunately, often the growth is not linear. You have to think about these edge cases, and write extra code to handle them.</p>
<p>This sort of thing comes up a lot. An example would be opening a file in C. You have to:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ss">* </span>Open the file for reading</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ss">* </span>Get the size of the file on disk</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="ss">* </span>Allocate a buffer large enough to store the file&#39;s contents</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="ss">* </span>Read from the file into the buffer</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="ss">* </span>Close the file</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="ss">* </span>Null terminate the buffer</span></code></pre></div>
<p>Basically all of these operations can go wrong. The buffer and the file pointer are resources that need to be cleaned up on failure. This complicates error handling. Opening a file isn't hard (although the language makes it much harder than it should be), but it's easy to accidentally leak the buffer or forget to close the file on one of the many errors if you're not careful. There's no other way to get it right than to squint at your monitor and trace through all the edge cases.</p>
<p>Now suppose your code is firmware supposed to handle something truly unlikely. For example, the internal flash inside your microcontroller fails mid-write. Or, the wires attaching some sensors to your airplane's engine controller get struck by a bolt of lightning, causing the readings to spike to physically impossible levels and then go dead as the wires melt. These situations aren't very testable. How can we be confident that they're handled correctly so the plane doesn't crash?</p>
<p><br></p>
<h2 id="the-solution-to-the-problem">The Solution to the Problem</h2>
<p>What we need is some way to make sure the number edge cases stays manageable. Here are a few ways.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="ss">* </span>Reduce the number of sources of error in project planning.</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="ss"> * </span>Limit the scope of the project.</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="ss"> * </span>Split the project up into manageable parts.</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="ss"> * </span>Use a library instead of rolling your own. (Ex: std::chrono/DateTime and leap seconds)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="ss">* </span>Group errors together with a uniform interface.</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="ss"> * </span>In POSIX C, <span class="in">`errno`</span> is 0 if no error, otherwise it&#39;s the error code.</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="ss"> * </span>In Java, the exception type is the error code, and it usually comes with a string explanation.</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="ss">* </span>Treat different kinds of errors the same.</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="ss"> * </span>In the Daisho <span class="in">`openFile()`</span> implementation, there are only two kinds of errors. There&#39;s &quot;out of memory&quot;, and there&#39;s &quot;couldn&#39;t open the file.&quot;</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>   The average programmer doesn&#39;t have to care if that&#39;s due to a failed integrity check or a sledgehammer. There&#39;s an argument that splitting out</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>   the OOM case is unnecessary also.</span></code></pre></div>
<h3 id="a-bigger-problem-needs-a-bigger-solution">A Bigger Problem Needs a Bigger Solution</h3>
<p>Unfortunately, this is not enough for me. A programming language runtime is truly massive. Trying to reverse engineer and configure what's available on each machine with its own exotic (or even mundane) archetecture and version of the C ecosystem is linearly more painful on the best of days, and exponentially on the worst. All known approaches have failed me. I've come up with my own instead.</p>
<p><br></p>
<h2 id="a-layered-taxonomy-of-errors">A Layered Taxonomy of Errors</h2>
<p>I found that what I really needed is to categorize. An error can happen during:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ss">* </span>Compiler configuration</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="ss">* </span>Compile time</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="ss">* </span>Run time</span></code></pre></div>
<p>An error is either recoverable or not recoverable. It may not even be an error necessarily. For example, not finding a <code>python</code> binary on the host system isn't necessarily a problem. It just means that the feature of being able to write inline python from daisho code is unavailable. It turns daisho code that is perfectly reasonable on one machine into a compile time error on another. It's only a problem if you're depending on it, but we still have to trace this information from compiler configuration into the compile time and runtime.</p>
</body>
</html>
